Часть 1: Описание бизнес-проблемы

1. Общие сведения

Наименование Бизнес-требования: Ликвидация дублирования номенклатуры в системе 1С
Заказчик: ООО «ЛИКАРД»
Ключевые пользователи: сотрудники ООО «ЛИКАРД» и ООО «МЦПБ»
Дата создания: 18.11.2025

2. Описание проблемы В системе 1С присутствуют дублирующиеся записи номенклатуры с одним и тем же кодом КССС. Это происходит из-за того, что при изменении атрибутов номенклатуры в КССС (например, классификатора ТМЦ) система WAY генерирует для нее новый HEX-CODE и передает в 1С как совершенно новый материал. 

В результате:
· Затруднено и удлинено закрытие отчетных периодов.
· Возникают ошибки в управлении товарно-материальными ценностями (ТМЦ).
· Искажается финансовый и регламентированный учет.

3. Цель и ожидаемые результаты Цель: Обеспечить уникальность записей номенклатуры в системе 1С по коду КССС для повышения качества и скорости ведения учета.

Ожидаемые результаты:

· Ликвидировано дублирование номенклатуры с одним и тем же кодом КССС.
· Сокращено время на закрытие периодов.
· Повышена достоверность данных по остаткам ТМЦ.
· Упрощены процессы управления номенклатурой.

4. Ключевые требования

1. Изменение механизма интеграции: Система 1С должна использовать Код КССС в качестве первичного ключа (уникального идентификатора) для записей номенклатуры, получаемых из системы WAY.
2. Сохранение служебных данных: Поля ID и HEX-CODE из системы WAY должны сохраняться в 1С не как часть первичного ключа, а как дополнительные реквизиты (атрибуты) справочника номенклатуры, по аналогии с КАСУ Петроникс.
3. Процедура нормализации данных: Необходимо выполнить одноразовую процедуру по очистке исторических данных, включающую:
   · Выявление и слияние дублирующихся записей.
   · Определение эталонной (актуальной) записи по каждому коду КССС.
   · Перенос остатков ТМЦ и истории операций с дубликатов на эталонные записи.
   · Архивацию или пометку на удаление дубликатов.

5. Ограничения

· Изменения не должны требовать модификации процесса генерации HEX-CODE в системе WAY.
· Процедура нормализации данных должна быть спланирована и проведена в период минимальной операционной активности (например, в выходные дни) для минимизации влияния на бизнес-процессы.

Часть 2: Техническое задание (ТЗ)

1. Введение

1.1. Наименование проекта: Изменение механизма приема номенклатуры из системы WAY в систему 1С и нормализация исторических данных. 
1.2. Краткое описание: В рамках проекта предлагается изменить бизнес-логику интеграции между системами WAY и 1С, сделав поле "Код КССС" уникальным идентификатором номенклатуры, а также провести очистку образовавшихся исторических дубликатов.

2. Основание для разработки 

Основанием является анализ процесса, выявивший причину появления дубликатов: генерация системой WAY нового HEX-CODE при изменении атрибутов номенклатуры в мастер системе КССС, который система 1С воспринимает как новый материал.

3. Цели и задачи

3.1. Цель: Устранить дублирование записей номенклатуры в системе 1С по полю "Код КССС" для обеспечения корректности учета.

3.2. Задачи:

1. Модифицировать конфигурацию 1С: изменить обработчик входящих данных от системы WAY.
2. Реализовать в 1С хранение служебных идентификаторов системы WAY (ID, HEX-CODE) в качестве дополнительных реквизитов для корректного приема транзакций от WAY.
3. Разработать и выполнить процедуру нормализации (очистки) исторических данных.
4. Протестировать новый механизм на тестовом контуре.

4. Требования к функционалу

4.1. Изменение механизма приема данных из WAY:

· Входные данные: Данные номенклатуры, полученные из системы WAY, содержащие поля: Код КССС, HEX-CODE, ID (из WAY), прочие атрибуты.
· Логика обработки:
  1. Система 1С должна искать существующую запись в справочнике "Номенклатура" по полю «Код КССС».
  2. Если запись найдена: Обновить ее атрибуты (наименование, классификатор и пр.) данными из входящего сообщения. Дополнить значения в дополнительных реквизитах HEX-CODE и ID (из WAY), если они ранее не содержатся в записи.
  3. Если запись не найдена: Создать новую запись в справочнике "Номенклатура", где:
     · «Код КССС» устанавливается в качестве основного уникального идентификатора.
     · Поля HEX-CODE и ID (из WAY) сохраняются в соответствующие дополнительные реквизиты.
· Выходные данные: Актуальная запись справочника "Номенклатура", где код КССС уникален.

4.2. Модификация структуры данных в 1С:

· Добавить в справочник "Номенклатура" два новых реквизита:
  · WayHexCode (Тип: Строка) — множественное поле для хранения HEX-CODE из системы WAY. – (наименование поля для примера)
  · WayInternalId (Тип: Строка/Число) — множественное поле для хранения внутреннего ID из системы WAY. – (наименование поля для примера)
· Обеспечить отображение этих полей в формах и, при необходимости, в отчетах.

4.3. Процедура нормализации исторических данных:

· Разработать алгоритм слияния дубликатов:
  1. Выявление групп дубликатов: Сформировать отчет, группирующий записи номенклатуры по полю "Код КССС", где количество записей > 1.
  2. Определение эталона: В каждой группе определить эталонную запись. Критерий: запись с самым последним HEX-CODE (или датой модификации, или код ID который является внутренним номером таблицы в WAY и логично что больший по значению код новее).
  3. Перенос остатков и движений:
     · Разработать механизм перепроведения документов, в которых участвуют дублирующиеся записи, с заменой на эталонную запись. (если необходимо, либо не реализовывать)
     · Разработать механизм переноса остатков ТМЦ с дубликатов на эталон.
  4. Архивация дубликатов: Пометить на удаление или переместить в отдельную группу все не-эталонные записи в группах дубликатов.
· Требования к выполнению (как пример):
  · Процедура должна быть выполнена в виде отдельной внешней обработки или отчета.
  · Обязательно создание подробного протокола действий (что будет изменено) перед запуском на выполнение.
  · Перед выполнением на продуктивной базе необходимо выполнить полное резервное копирование.

5. Требования к интеграции

· Обеспечить обратную совместимость с системой WAY. Формат обмена данными с стороны WAY изменять не требуется.
· Новый механизм должен корректно обрабатывать как ежедневные инкрементальные выгрузки, так и массовые перевыгрузки справочника из WAY.

6. Нефункциональные требования

· Производительность: Новый алгоритм приема данных не должен увеличивать время обмена с системой WAY более чем на 10%. (если релевантно)
· Безопасность: Процедура нормализации данных должна быть доступна только для пользователей с правами администратора. (либо другими правами, необходимо уточнить)
· Надежность: Процедура слияния должна быть атомарной в рамках одного кода КССС и обеспечивать целостность данных.

7. Этапы реализации и приемки
(как пример)
1. Этап 1: Проектирование и согласование изменений в конфигурации 1С.
2. Этап 2: Разработка и тестирование нового механизма приема данных на тестовом контуре.
3. Этап 3: Разработка и согласование процедуры нормализации данных.
4. Этап 4: Проведение процедуры нормализации на тестовом контуре с проверкой результатов.
5. Этап 5: Внедрение в промышленную эксплуатацию (требуется окно обслуживания). Порядок:
   · Остановка регламентных заданий по обмену с WAY.
   · Выполнение полного резервного копирования базы 1С.
   · Проведение процедуры нормализации данных.
   · Включение нового механизма приема данных.
   · Возобновление обмена с WAY.
   · Мониторинг корректности работы в течение первых рабочих дней.
